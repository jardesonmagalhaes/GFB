<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jardeson GFB - Gestão Financeira</title>

    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#10b981"/>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Jardeson GFB">
    <meta name="description" content="Seu Gerenciador de Contas de Apostas.">
    <!-- O link para o manifest será injetado via script -->
    
    <!-- Tailwind CSS para um design moderno e responsivo -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Font Awesome para ícones -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    
    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;900&display=swap" rel="stylesheet">

    <style>
        /* Estilo base com a fonte Inter */
        body {
            font-family: 'Inter', sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* Animação para a entrada de novos itens na lista */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .fade-in { animation: fadeIn 0.5s ease-out forwards; }
        
        /* Estilização da barra de rolagem */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #1f2937; }
        ::-webkit-scrollbar-thumb { background: #4b5563; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: #6b7280; }
    </style>
</head>
<body class="bg-gray-900 text-white">

    <div class="container mx-auto p-4 sm:p-6 md:p-8 max-w-5xl">
        
        <!-- Cabeçalho -->
        <header class="text-center mb-8">
            <h1 class="text-4xl md:text-5xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-emerald-400 to-cyan-400">
                Jardeson GFB
            </h1>
            <p class="text-gray-400 mt-2">Seu Gerenciador de Contas de Apostas</p>
        </header>

        <main>
            <!-- Painel de Resumo Atualizado -->
            <section id="summary" class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
                <!-- Card Balanço Total (Lucro Líquido) -->
                <div class="bg-gray-800 p-6 rounded-xl shadow-lg flex items-center space-x-4 col-span-2 md:col-span-2">
                    <div class="bg-blue-500/20 p-3 rounded-full">
                        <i class="fa-solid fa-scale-balanced fa-2x text-blue-400"></i>
                    </div>
                    <div>
                        <p class="text-gray-400 text-sm">Balanço Total</p>
                        <p id="totalProfit" class="text-2xl font-bold">R$ 0,00</p>
                    </div>
                </div>
                 <!-- Card Total de Lançamentos -->
                <div class="bg-gray-800 p-6 rounded-xl shadow-lg flex items-center space-x-4">
                    <div class="bg-purple-500/20 p-3 rounded-full">
                        <i class="fa-solid fa-list-check fa-2x text-purple-400"></i>
                    </div>
                    <div>
                        <p class="text-gray-400 text-sm">Lançamentos</p>
                        <p id="totalEntries" class="text-2xl font-bold">0</p>
                    </div>
                </div>
                <!-- Card Lucro Médio -->
                <div class="bg-gray-800 p-6 rounded-xl shadow-lg flex items-center space-x-4">
                    <div class="bg-yellow-500/20 p-3 rounded-full">
                        <i class="fa-solid fa-chart-pie fa-2x text-yellow-400"></i>
                    </div>
                    <div>
                        <p class="text-gray-400 text-sm">Média / Lanç.</p>
                        <p id="averageProfit" class="text-2xl font-bold">R$ 0,00</p>
                    </div>
                </div>
                <!-- Card Total Ganhos -->
                <div class="bg-gray-800 p-6 rounded-xl shadow-lg flex items-center space-x-4 col-span-2">
                     <div class="bg-green-500/20 p-3 rounded-full">
                        <i class="fa-solid fa-arrow-up fa-2x text-green-400"></i>
                    </div>
                    <div>
                        <p class="text-gray-400 text-sm">Total Ganhos</p>
                        <p id="totalGains" class="text-2xl font-bold text-green-400">R$ 0,00</p>
                    </div>
                </div>
                 <!-- Card Total Perdas -->
                <div class="bg-gray-800 p-6 rounded-xl shadow-lg flex items-center space-x-4 col-span-2">
                     <div class="bg-red-500/20 p-3 rounded-full">
                        <i class="fa-solid fa-arrow-down fa-2x text-red-500"></i>
                    </div>
                    <div>
                        <p class="text-gray-400 text-sm">Total Perdas</p>
                        <p id="totalLosses" class="text-2xl font-bold text-red-500">R$ 0,00</p>
                    </div>
                </div>
            </section>

            <!-- Formulário de Cadastro -->
            <section class="bg-gray-800 p-6 rounded-xl shadow-lg mb-8">
                <h2 class="text-2xl font-bold mb-4 text-emerald-400">Novo Lançamento</h2>
                <form id="entryForm" class="grid grid-cols-1 md:grid-cols-2 gap-4 items-end">
                    <!-- Nome do Dono da Conta -->
                    <div>
                        <label for="userName" class="block mb-2 text-sm font-medium text-gray-300">Nome do Dono da Conta</label>
                        <input type="text" id="userName" name="userName" class="w-full bg-gray-700 border border-gray-600 rounded-lg p-3 focus:ring-emerald-500 focus:border-emerald-500 transition" placeholder="Ex: João da Silva" required>
                    </div>

                    <!-- Casa de Aposta -->
                    <div>
                        <label for="bettingHouse" class="block mb-2 text-sm font-medium text-gray-300">Casa de Aposta</label>
                        <select id="bettingHouse" name="bettingHouse" class="w-full bg-gray-700 border border-gray-600 rounded-lg p-3 focus:ring-emerald-500 focus:border-emerald-500 transition" required>
                            <option value="Bet365">Bet365</option>
                            <option value="Betano">Betano</option>
                            <option value="Superbet">Superbet</option>
                        </select>
                    </div>

                    <!-- Lucro/Prejuízo -->
                    <div>
                        <label for="profit" class="block mb-2 text-sm font-medium text-gray-300">Valor (Lucro/Prejuízo R$)</label>
                        <input type="number" id="profit" name="profit" step="0.01" class="w-full bg-gray-700 border border-gray-600 rounded-lg p-3 focus:ring-emerald-500 focus:border-emerald-500 transition" placeholder="Positivo para lucro, negativo para perda. Ex: -50.25" required>
                    </div>
                    
                    <!-- Botão de Adicionar -->
                    <div class="md:col-span-2">
                        <button type="submit" class="w-full bg-gradient-to-r from-emerald-500 to-cyan-500 hover:from-emerald-600 hover:to-cyan-600 text-white font-bold py-3 px-6 rounded-lg shadow-lg transition-transform transform hover:scale-105">
                            <i class="fas fa-plus-circle mr-2"></i> Adicionar Lançamento
                        </button>
                    </div>
                </form>
            </section>

            <!-- Tabela de Lançamentos -->
            <section>
                 <h2 class="text-2xl font-bold mb-4 text-cyan-400">Histórico de Lançamentos</h2>
                 <div class="bg-gray-800 rounded-xl shadow-lg overflow-hidden">
                    <div class="overflow-x-auto">
                        <table class="w-full text-left">
                            <thead class="bg-gray-700/50">
                                <tr>
                                    <th class="p-4 font-semibold">Dono da Conta</th>
                                    <th class="p-4 font-semibold">Casa de Aposta</th>
                                    <th class="p-4 font-semibold">Valor</th>
                                    <th class="p-4 font-semibold">Data e Hora</th>
                                    <th class="p-4 font-semibold text-center">Ações</th>
                                </tr>
                            </thead>
                            <tbody id="entriesTableBody"></tbody>
                        </table>
                    </div>
                 </div>
            </section>

        </main>
    </div>

    <!-- Modal de Confirmação de Exclusão -->
    <div id="deleteModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center hidden z-50 transition-opacity duration-300 opacity-0">
        <div class="bg-gray-800 rounded-xl shadow-xl p-6 w-full max-w-sm transform transition-all duration-300 scale-95 opacity-0" id="modal-content">
            <h3 class="text-lg font-bold text-white mb-4">Confirmar Exclusão</h3>
            <p class="text-gray-300 mb-6">Você tem certeza que deseja apagar este lançamento? Esta ação não pode ser desfeita.</p>
            <div class="flex justify-end space-x-4">
                <button id="cancelDelete" class="px-4 py-2 bg-gray-600 hover:bg-gray-500 rounded-lg text-white font-medium transition-transform transform hover:scale-105">Cancelar</button>
                <button id="confirmDelete" class="px-4 py-2 bg-red-600 hover:bg-red-500 rounded-lg text-white font-medium transition-transform transform hover:scale-105">Apagar</button>
            </div>
        </div>
    </div>

    <!-- Script principal da aplicação -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const entryForm = document.getElementById('entryForm');
            const entriesTableBody = document.getElementById('entriesTableBody');
            
            // Elementos do painel de resumo
            const totalProfitEl = document.getElementById('totalProfit');
            const totalEntriesEl = document.getElementById('totalEntries');
            const averageProfitEl = document.getElementById('averageProfit');
            const totalGainsEl = document.getElementById('totalGains');
            const totalLossesEl = document.getElementById('totalLosses');

            // Elementos do modal
            const deleteModal = document.getElementById('deleteModal');
            const modalContent = document.getElementById('modal-content');
            const confirmDeleteBtn = document.getElementById('confirmDelete');
            const cancelDeleteBtn = document.getElementById('cancelDelete');
            let entryIdToDelete = null;

            // --- Lógica do PWA (Progressive Web App) ---
            const setupPWA = () => {
                // 1. Criar o conteúdo do manifest.json
                const manifest = {
                    "name": "Jardeson GFB - Gestão Financeira",
                    "short_name": "Jardeson GFB",
                    "description": "Seu Gerenciador de Contas de Apostas.",
                    "start_url": ".",
                    "display": "standalone",
                    "background_color": "#111827",
                    "theme_color": "#10b981",
                    "icons": [
                        { "src": "https://placehold.co/192x192/10b981/FFFFFF?text=JG&font=inter", "type": "image/png", "sizes": "192x192" },
                        { "src": "https://placehold.co/512x512/10b981/FFFFFF?text=JG&font=inter", "type": "image/png", "sizes": "512x512" }
                    ]
                };

                // 2. Injetar o link do manifest no <head> usando um Data URI
                const manifestBlob = new Blob([JSON.stringify(manifest)], { type: 'application/json' });
                const manifestURL = URL.createObjectURL(manifestBlob);
                const linkEl = document.createElement('link');
                linkEl.rel = 'manifest';
                linkEl.href = manifestURL;
                document.head.appendChild(linkEl);

                // 3. Registrar o Service Worker
                if ('serviceWorker' in navigator) {
                    const swContent = `
                        const CACHE_NAME = 'jardeson-gfb-cache-v1';
                        const urlsToCache = ['./'];
                        self.addEventListener('install', event => {
                            event.waitUntil(
                                caches.open(CACHE_NAME).then(cache => cache.addAll(urlsToCache))
                            );
                        });
                        self.addEventListener('fetch', event => {
                            event.respondWith(
                                caches.match(event.request).then(response => response || fetch(event.request))
                            );
                        });
                    `;
                    const swBlob = new Blob([swContent], { type: 'application/javascript' });
                    const swURL = URL.createObjectURL(swBlob);
                    
                    navigator.serviceWorker.register(swURL)
                        .then(reg => console.log('Service worker registrado com sucesso:', reg))
                        .catch(err => console.error('Falha ao registrar service worker:', err));
                }
            };
            
            // --- Lógica da Aplicação ---
            const getEntries = () => JSON.parse(localStorage.getItem('bettingEntries')) || [];
            const saveEntries = (entries) => localStorage.setItem('bettingEntries', JSON.stringify(entries));
            const formatCurrency = (value) => value.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });

            const updateSummary = () => {
                const entries = getEntries();
                const totalProfit = entries.reduce((sum, entry) => sum + entry.profit, 0);
                const totalGains = entries.filter(e => e.profit > 0).reduce((sum, e) => sum + e.profit, 0);
                const totalLosses = entries.filter(e => e.profit < 0).reduce((sum, e) => sum + e.profit, 0);
                const totalEntries = entries.length;
                const averageProfit = totalEntries > 0 ? totalProfit / totalEntries : 0;

                totalProfitEl.textContent = formatCurrency(totalProfit);
                totalProfitEl.className = `text-2xl font-bold ${totalProfit >= 0 ? 'text-white' : 'text-red-500'}`;
                totalEntriesEl.textContent = totalEntries;
                averageProfitEl.textContent = formatCurrency(averageProfit);
                totalGainsEl.textContent = formatCurrency(totalGains);
                totalLossesEl.textContent = formatCurrency(totalLosses);
            };

            const renderEntries = () => {
                const entries = getEntries();
                entriesTableBody.innerHTML = '';

                if (entries.length === 0) {
                     entriesTableBody.innerHTML = `<tr><td colspan="5" class="text-center text-gray-500 p-8"><i class="fas fa-folder-open fa-3x mb-2"></i><p>Nenhum lançamento cadastrado.</p></td></tr>`;
                } else {
                    entries.sort((a, b) => b.id - a.id).forEach(entry => {
                        const row = document.createElement('tr');
                        row.className = 'border-b border-gray-700 hover:bg-gray-700/50 transition-colors fade-in';
                        
                        const date = new Date(entry.date).toLocaleString('pt-BR', { day: '2-digit', month: '2-digit', year: 'numeric', hour: '2-digit', minute: '2-digit' });
                        const profitColor = entry.profit >= 0 ? 'text-green-400' : 'text-red-500';

                        row.innerHTML = `
                            <td class="p-4">${entry.userName}</td>
                            <td class="p-4">${entry.bettingHouse}</td>
                            <td class="p-4 font-medium ${profitColor}">${formatCurrency(entry.profit)}</td>
                            <td class="p-4 text-gray-400">${date.replace(',', ' às')}</td>
                            <td class="p-4 text-center">
                                <button data-id="${entry.id}" class="delete-btn text-gray-400 hover:text-red-500 transition-colors"><i class="fas fa-trash-alt"></i></button>
                            </td>
                        `;
                        entriesTableBody.appendChild(row);
                    });
                }
                updateSummary();
            };

            entryForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const userName = e.target.userName.value.trim();
                const bettingHouse = e.target.bettingHouse.value;
                const profit = parseFloat(e.target.profit.value);

                if (!userName || isNaN(profit)) {
                    console.error("Dados inválidos");
                    return;
                }
                
                const newEntry = { id: Date.now(), userName, bettingHouse, profit, date: new Date().toISOString() };
                const entries = getEntries();
                entries.push(newEntry);
                saveEntries(entries);
                entryForm.reset();
                renderEntries();
            });

            const toggleModal = (show) => {
                if (show) {
                    deleteModal.classList.remove('hidden');
                    setTimeout(() => {
                        deleteModal.classList.remove('opacity-0');
                        modalContent.classList.remove('scale-95', 'opacity-0');
                    }, 10);
                } else {
                    deleteModal.classList.add('opacity-0');
                    modalContent.classList.add('scale-95', 'opacity-0');
                    setTimeout(() => {
                        deleteModal.classList.add('hidden');
                        entryIdToDelete = null;
                    }, 300);
                }
            };

            entriesTableBody.addEventListener('click', (e) => {
                const deleteButton = e.target.closest('.delete-btn');
                if (deleteButton) {
                    entryIdToDelete = parseInt(deleteButton.getAttribute('data-id'));
                    toggleModal(true);
                }
            });

            cancelDeleteBtn.addEventListener('click', () => toggleModal(false));
            confirmDeleteBtn.addEventListener('click', () => {
                if (entryIdToDelete !== null) {
                    let entries = getEntries();
                    entries = entries.filter(entry => entry.id !== entryIdToDelete);
                    saveEntries(entries);
                    renderEntries();
                    toggleModal(false);
                }
            });

            // --- Inicialização ---
            setupPWA();
            renderEntries();
        });
    </script>
</body>
</html>

